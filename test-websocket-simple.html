<!DOCTYPE html>
<html>
  <head>
    <title>WebSocket Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .log {
        background: #f0f0f0;
        padding: 10px;
        margin: 5px 0;
        border-radius: 5px;
      }
      .success {
        color: green;
      }
      .error {
        color: red;
      }
      .info {
        color: blue;
      }
    </style>
  </head>
  <body>
    <h1>WebSocket Connection Test</h1>
    <button onclick="testConnection()">Test WebSocket</button>
    <div id="logs"></div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
      function log(message, type = "info") {
        const logs = document.getElementById("logs");
        const div = document.createElement("div");
        div.className = `log ${type}`;
        div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        logs.appendChild(div);
      }

      function testConnection() {
        log("🔍 Testing WebSocket connection...", "info");

        // Get token from localStorage or cookies
        let token = localStorage.getItem("accessToken");
        if (!token) {
          const cookies = document.cookie.split(";");
          const tokenCookie = cookies.find((cookie) =>
            cookie.trim().startsWith("accessToken=")
          );
          if (tokenCookie) {
            token = decodeURIComponent(tokenCookie.split("=")[1]);
          }
        }

        if (!token) {
          log("❌ No token found. Please login first.", "error");
          return;
        }

        log(`✅ Token found: ${token.substring(0, 20)}...`, "success");

        // Test WebSocket connection
        const socket = io("http://localhost:4000", {
          path: "/ws",
          auth: { token: token },
          extraHeaders: { Authorization: `Bearer ${token}` },
          transports: ["websocket", "polling"],
          timeout: 10000,
        });

        socket.on("connect", () => {
          log("✅ WebSocket connected successfully!", "success");
          log(`Socket ID: ${socket.id}`, "info");
          socket.disconnect();
        });

        socket.on("connect_error", (error) => {
          log(`❌ WebSocket error: ${error.message}`, "error");
          log(`Error type: ${error.type}`, "error");
        });

        socket.on("disconnect", (reason) => {
          log(`🔌 Disconnected: ${reason}`, "info");
        });
      }
    </script>
  </body>
</html>

