<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Checkin Status Display</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        .loading {
            color: #6c757d;
            font-style: italic;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin: 2px;
        }
        .status-registered { background: #dbeafe; color: #1e40af; }
        .status-checked-in { background: #dcfce7; color: #166534; }
        .status-checked-out { background: #fed7aa; color: #c2410c; }
        .status-cancelled { background: #fecaca; color: #dc2626; }
        .status-no-show { background: #f3f4f6; color: #374151; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Test Checkin Status Display</h1>
        <p>Ki·ªÉm tra t√≠nh nƒÉng hi·ªÉn th·ªã tr·∫°ng th√°i checkin c·ªßa attendees</p>

        <div class="test-section">
            <h3>1. Test Status Calculation Logic</h3>
            <button onclick="testStatusCalculation()">Test Status Calculation</button>
            <div id="status-calc-results" class="result"></div>
        </div>

        <div class="test-section">
            <h3>2. Test Attendee Status Display</h3>
            <button onclick="testAttendeeStatusDisplay()">Test Attendee Status Display</button>
            <div id="status-display-results" class="result"></div>
        </div>

        <div class="test-section">
            <h3>3. Test Status Filtering</h3>
            <button onclick="testStatusFiltering()">Test Status Filtering</button>
            <div id="status-filter-results" class="result"></div>
        </div>

        <div class="test-section">
            <h3>4. Test Status Badge Rendering</h3>
            <button onclick="testStatusBadges()">Test Status Badges</button>
            <div id="status-badge-results" class="result"></div>
        </div>
    </div>

    <script>
        // Mock data for testing
        const mockRegistrations = [
            {
                ID: 1,
                CONFERENCE_ID: 1,
                ATTENDEE_ID: 1,
                STATUS: 'registered',
                QR_CODE: 'QR001',
                REGISTRATION_DATE: new Date('2024-01-01'),
                CHECKIN_TIME: null,
                CHECKOUT_TIME: null
            },
            {
                ID: 2,
                CONFERENCE_ID: 1,
                ATTENDEE_ID: 2,
                STATUS: 'registered',
                QR_CODE: 'QR002',
                REGISTRATION_DATE: new Date('2024-01-01'),
                CHECKIN_TIME: new Date('2024-01-15T09:00:00'),
                CHECKOUT_TIME: null
            },
            {
                ID: 3,
                CONFERENCE_ID: 1,
                ATTENDEE_ID: 3,
                STATUS: 'registered',
                QR_CODE: 'QR003',
                REGISTRATION_DATE: new Date('2024-01-01'),
                CHECKIN_TIME: new Date('2024-01-15T09:00:00'),
                CHECKOUT_TIME: new Date('2024-01-15T17:00:00')
            },
            {
                ID: 4,
                CONFERENCE_ID: 1,
                ATTENDEE_ID: 4,
                STATUS: 'cancelled',
                QR_CODE: 'QR004',
                REGISTRATION_DATE: new Date('2024-01-01'),
                CHECKIN_TIME: null,
                CHECKOUT_TIME: null
            },
            {
                ID: 5,
                CONFERENCE_ID: 1,
                ATTENDEE_ID: 5,
                STATUS: 'no-show',
                QR_CODE: 'QR005',
                REGISTRATION_DATE: new Date('2024-01-01'),
                CHECKIN_TIME: null,
                CHECKOUT_TIME: null
            }
        ];

        // Status calculation logic (copied from the hook)
        function calculateOverallStatus(registrations) {
            if (registrations.length === 0) {
                return 'registered';
            }

            // L·∫•y registration m·ªõi nh·∫•t
            const latestRegistration = registrations.reduce((latest, current) => {
                return new Date(current.REGISTRATION_DATE) > new Date(latest.REGISTRATION_DATE) ? current : latest;
            });

            // Ki·ªÉm tra tr·∫°ng th√°i
            if (latestRegistration.STATUS === 'cancelled') {
                return 'cancelled';
            }

            if (latestRegistration.CHECKOUT_TIME) {
                return 'checked-out';
            }

            if (latestRegistration.CHECKIN_TIME) {
                return 'checked-in';
            }

            if (latestRegistration.STATUS === 'no-show') {
                return 'no-show';
            }

            return 'registered';
        }

        function getLastCheckinTime(registrations) {
            const checkinTimes = registrations
                .filter(reg => reg.CHECKIN_TIME)
                .map(reg => new Date(reg.CHECKIN_TIME))
                .sort((a, b) => b.getTime() - a.getTime());
            
            return checkinTimes.length > 0 ? checkinTimes[0] : undefined;
        }

        function getLastCheckoutTime(registrations) {
            const checkoutTimes = registrations
                .filter(reg => reg.CHECKOUT_TIME)
                .map(reg => new Date(reg.CHECKOUT_TIME))
                .sort((a, b) => b.getTime() - a.getTime());
            
            return checkoutTimes.length > 0 ? checkoutTimes[0] : undefined;
        }

        function testStatusCalculation() {
            const resultsDiv = document.getElementById('status-calc-results');
            resultsDiv.innerHTML = '<div class="loading">Testing status calculation logic...</div>';
            
            try {
                const results = mockRegistrations.map((reg, index) => {
                    const status = calculateOverallStatus([reg]);
                    const lastCheckin = getLastCheckinTime([reg]);
                    const lastCheckout = getLastCheckoutTime([reg]);
                    
                    return {
                        attendeeId: reg.ATTENDEE_ID,
                        registrationStatus: reg.STATUS,
                        hasCheckin: !!reg.CHECKIN_TIME,
                        hasCheckout: !!reg.CHECKOUT_TIME,
                        calculatedStatus: status,
                        lastCheckinTime: lastCheckin,
                        lastCheckoutTime: lastCheckout
                    };
                });
                
                resultsDiv.innerHTML = `<div class="success">‚úÖ Status calculation working\n\nResults:\n${JSON.stringify(results, null, 2)}</div>`;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">‚ùå Status calculation failed: ${error.message}</div>`;
            }
        }

        function testAttendeeStatusDisplay() {
            const resultsDiv = document.getElementById('status-display-results');
            resultsDiv.innerHTML = '<div class="loading">Testing attendee status display...</div>';
            
            try {
                const attendees = [
                    { ID: 1, NAME: 'Nguy·ªÖn VƒÉn A', registrations: [mockRegistrations[0]] },
                    { ID: 2, NAME: 'Tr·∫ßn Th·ªã B', registrations: [mockRegistrations[1]] },
                    { ID: 3, NAME: 'L√™ VƒÉn C', registrations: [mockRegistrations[2]] },
                    { ID: 4, NAME: 'Ph·∫°m Th·ªã D', registrations: [mockRegistrations[3]] },
                    { ID: 5, NAME: 'Ho√†ng VƒÉn E', registrations: [mockRegistrations[4]] }
                ];

                const attendeesWithStatus = attendees.map(attendee => {
                    const status = calculateOverallStatus(attendee.registrations);
                    const lastCheckin = getLastCheckinTime(attendee.registrations);
                    const lastCheckout = getLastCheckoutTime(attendee.registrations);
                    
                    return {
                        ...attendee,
                        overallStatus: status,
                        lastCheckinTime: lastCheckin,
                        lastCheckoutTime: lastCheckout
                    };
                });
                
                resultsDiv.innerHTML = `<div class="success">‚úÖ Attendee status display working\n\nAttendees with status:\n${JSON.stringify(attendeesWithStatus, null, 2)}</div>`;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">‚ùå Attendee status display failed: ${error.message}</div>`;
            }
        }

        function testStatusFiltering() {
            const resultsDiv = document.getElementById('status-filter-results');
            resultsDiv.innerHTML = '<div class="loading">Testing status filtering...</div>';
            
            try {
                const attendees = [
                    { ID: 1, NAME: 'Nguy·ªÖn VƒÉn A', overallStatus: 'registered' },
                    { ID: 2, NAME: 'Tr·∫ßn Th·ªã B', overallStatus: 'checked-in' },
                    { ID: 3, NAME: 'L√™ VƒÉn C', overallStatus: 'checked-out' },
                    { ID: 4, NAME: 'Ph·∫°m Th·ªã D', overallStatus: 'cancelled' },
                    { ID: 5, NAME: 'Ho√†ng VƒÉn E', overallStatus: 'no-show' }
                ];

                const filterByStatus = (attendees, status) => {
                    if (status === 'all') return attendees;
                    return attendees.filter(attendee => attendee.overallStatus === status);
                };

                const allStatuses = ['all', 'registered', 'checked-in', 'checked-out', 'cancelled', 'no-show'];
                const filterResults = allStatuses.map(status => ({
                    filter: status,
                    count: filterByStatus(attendees, status).length,
                    attendees: filterByStatus(attendees, status).map(a => a.NAME)
                }));
                
                resultsDiv.innerHTML = `<div class="success">‚úÖ Status filtering working\n\nFilter results:\n${JSON.stringify(filterResults, null, 2)}</div>`;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">‚ùå Status filtering failed: ${error.message}</div>`;
            }
        }

        function testStatusBadges() {
            const resultsDiv = document.getElementById('status-badge-results');
            resultsDiv.innerHTML = '<div class="loading">Testing status badges...</div>';
            
            try {
                const statuses = ['registered', 'checked-in', 'checked-out', 'cancelled', 'no-show'];
                
                const badgeHtml = statuses.map(status => {
                    const statusConfig = {
                        registered: { label: "ƒê√£ ƒëƒÉng k√Ω", color: "status-registered", icon: "üìù" },
                        "checked-in": { label: "ƒê√£ check-in", color: "status-checked-in", icon: "‚úÖ" },
                        "checked-out": { label: "ƒê√£ check-out", color: "status-checked-out", icon: "üö™" },
                        cancelled: { label: "ƒê√£ h·ªßy", color: "status-cancelled", icon: "‚ùå" },
                        "no-show": { label: "Kh√¥ng tham d·ª±", color: "status-no-show", icon: "‚è∞" }
                    };
                    
                    const config = statusConfig[status];
                    return `<span class="status-badge ${config.color}">${config.icon} ${config.label}</span>`;
                }).join(' ');
                
                resultsDiv.innerHTML = `<div class="success">‚úÖ Status badges working\n\nBadge examples:\n${badgeHtml}</div>`;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">‚ùå Status badges failed: ${error.message}</div>`;
            }
        }

        // Auto-run basic tests on load
        window.addEventListener('load', () => {
            console.log('Page loaded, running basic tests...');
            testStatusCalculation();
        });
    </script>
</body>
</html>
