<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug Frontend Token</title>
  </head>
  <body>
    <h1>Debug Frontend Token</h1>
    <div id="output"></div>

    <script>
      function log(message) {
        const output = document.getElementById("output");
        const div = document.createElement("div");
        div.innerHTML = `<strong>${new Date().toISOString()}:</strong> ${message}`;
        output.appendChild(div);
        console.log(message);
      }

      function debugToken() {
        log("=== Token Debug ===");

        // Check localStorage
        const localToken = localStorage.getItem("accessToken");
        log(
          `localStorage token: ${
            localToken ? localToken.substring(0, 20) + "..." : "none"
          }`
        );
        log(`localStorage token length: ${localToken?.length || 0}`);

        // Check cookies
        const cookies = document.cookie.split(";");
        const tokenCookie = cookies.find((cookie) =>
          cookie.trim().startsWith("accessToken=")
        );
        const cookieToken = tokenCookie ? tokenCookie.split("=")[1] : null;
        log(
          `Cookie token: ${
            cookieToken ? cookieToken.substring(0, 20) + "..." : "none"
          }`
        );
        log(`Cookie token length: ${cookieToken?.length || 0}`);

        // Check if tokens are the same
        if (localToken && cookieToken) {
          log(`Tokens match: ${localToken === cookieToken}`);
        }

        // Use the same logic as websocket.ts
        const token = cookieToken || localToken;
        log(
          `Selected token: ${token ? token.substring(0, 20) + "..." : "none"}`
        );

        if (token) {
          try {
            const parts = token.split(".");
            if (parts.length === 3) {
              const payload = JSON.parse(atob(parts[1]));
              log("Token payload:");
              log(
                JSON.stringify(
                  {
                    userId: payload.userId,
                    email: payload.email,
                    role: payload.role,
                    exp: payload.exp,
                    iat: payload.iat,
                    expDate: new Date(payload.exp * 1000).toISOString(),
                    currentTime: new Date().toISOString(),
                    isExpired: Date.now() >= payload.exp * 1000,
                  },
                  null,
                  2
                )
              );
            } else {
              log("Invalid JWT format - not 3 parts");
            }
          } catch (error) {
            log(`Failed to parse token: ${error.message}`);
          }
        } else {
          log("No token found");
        }
      }

      // Run debug when page loads
      window.addEventListener("load", debugToken);
    </script>
  </body>
</html>


