<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Checkin Status Fix</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin: 2px;
        }
        .status-registered { background-color: #dbeafe; color: #1e40af; }
        .status-checked-in { background-color: #dcfce7; color: #166534; }
        .status-checked-out { background-color: #fed7aa; color: #c2410c; }
        .status-cancelled { background-color: #fecaca; color: #dc2626; }
        .status-no-show { background-color: #f3f4f6; color: #6b7280; }
        
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
        }
        
        .api-response {
            background-color: #f8fafc;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            margin: 10px 0;
        }
        
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .success { background-color: #dcfce7; color: #166534; }
        .error { background-color: #fecaca; color: #dc2626; }
        
        button {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background-color: #2563eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Test Checkin Status Fix</h1>
        <p>Ki·ªÉm tra logic hi·ªÉn th·ªã tr·∫°ng th√°i checkin sau khi s·ª≠a l·ªói</p>
    </div>

    <div class="container">
        <h2>üìä Test Case 1: API Response v·ªõi STATUS "checked-in"</h2>
        <div class="test-section">
            <h3>API Response:</h3>
            <div class="api-response">{
    "data": [
        {
            "ID": 1,
            "CONFERENCE_ID": 1,
            "STATUS": "checked-in",
            "QR_CODE": "REG-1-5-16D7106113",
            "REGISTRATION_DATE": "2025-09-02T16:23:23.873Z"
        }
    ]
}</div>
            
            <button onclick="testStatusCalculation()">Test Status Calculation</button>
            <div id="result1" class="result" style="display: none;"></div>
        </div>
    </div>

    <div class="container">
        <h2>üìä Test Case 2: Multiple Registrations</h2>
        <div class="test-section">
            <h3>API Response:</h3>
            <div class="api-response">{
    "data": [
        {
            "ID": 1,
            "CONFERENCE_ID": 1,
            "STATUS": "registered",
            "QR_CODE": "REG-1-5-16D7106113",
            "REGISTRATION_DATE": "2025-09-01T10:00:00.000Z"
        },
        {
            "ID": 2,
            "CONFERENCE_ID": 1,
            "STATUS": "checked-in",
            "QR_CODE": "REG-2-5-16D7106114",
            "REGISTRATION_DATE": "2025-09-02T16:23:23.873Z"
        }
    ]
}</div>
            
            <button onclick="testMultipleRegistrations()">Test Multiple Registrations</button>
            <div id="result2" class="result" style="display: none;"></div>
        </div>
    </div>

    <div class="container">
        <h2>üìä Test Case 3: Checked-out Status</h2>
        <div class="test-section">
            <h3>API Response:</h3>
            <div class="api-response">{
    "data": [
        {
            "ID": 1,
            "CONFERENCE_ID": 1,
            "STATUS": "checked-out",
            "QR_CODE": "REG-1-5-16D7106113",
            "REGISTRATION_DATE": "2025-09-02T18:30:00.000Z"
        }
    ]
}</div>
            
            <button onclick="testCheckedOutStatus()">Test Checked-out Status</button>
            <div id="result3" class="result" style="display: none;"></div>
        </div>
    </div>

    <div class="container">
        <h2>üìä Test Case 4: No Registrations</h2>
        <div class="test-section">
            <h3>API Response:</h3>
            <div class="api-response">{
    "data": []
}</div>
            
            <button onclick="testNoRegistrations()">Test No Registrations</button>
            <div id="result4" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Simulate the calculateOverallStatus function
        function calculateOverallStatus(registrations) {
            if (registrations.length === 0) {
                console.log('üìù No registrations, returning not-registered');
                return 'not-registered';
            }

            console.log(`üîç Processing ${registrations.length} registrations`);

            // L·∫•y registration m·ªõi nh·∫•t d·ª±a tr√™n th·ªùi gian registration date
            const latestRegistration = registrations.reduce((latest, current) => {
                const latestTime = latest.REGISTRATION_DATE;
                const currentTime = current.REGISTRATION_DATE;
                
                const latestDate = new Date(latestTime);
                const currentDate = new Date(currentTime);
                
                return currentDate > latestDate ? current : latest;
            });

            console.log('üîç Final registration selected:', {
                id: latestRegistration.ID,
                status: latestRegistration.STATUS,
                registrationDate: latestRegistration.REGISTRATION_DATE
            });

            // S·ª≠ d·ª•ng tr∆∞·ªùng STATUS t·ª´ API ƒë·ªÉ x√°c ƒë·ªãnh tr·∫°ng th√°i
            const status = latestRegistration.STATUS.toLowerCase();
            
            // Ki·ªÉm tra tr·∫°ng th√°i theo th·ª© t·ª± ∆∞u ti√™n
            if (status === 'cancelled') {
                console.log('‚úÖ Status: cancelled');
                return 'cancelled';
            }

            if (status === 'no-show') {
                console.log('‚úÖ Status: no-show');
                return 'no-show';
            }

            if (status === 'checked-out') {
                console.log('‚úÖ Status: checked-out');
                return 'checked-out';
            }

            if (status === 'checked-in') {
                console.log('‚úÖ Status: checked-in');
                return 'checked-in';
            }

            console.log('‚úÖ Status: registered (default)');
            return 'registered';
        }

        function getStatusBadge(status) {
            const statusConfig = {
                "not-registered": { label: "Ch∆∞a ƒëƒÉng k√Ω", color: "status-no-show" },
                registered: { label: "ƒê√£ ƒëƒÉng k√Ω", color: "status-registered" },
                "checked-in": { label: "ƒê√£ check-in", color: "status-checked-in" },
                "checked-out": { label: "ƒê√£ check-out", color: "status-checked-out" },
                cancelled: { label: "ƒê√£ h·ªßy", color: "status-cancelled" },
                "no-show": { label: "Kh√¥ng tham d·ª±", color: "status-no-show" }
            };
            
            const config = statusConfig[status] || statusConfig.registered;
            return `<span class="status-badge ${config.color}">${config.label}</span>`;
        }

        function testStatusCalculation() {
            const registrations = [
                {
                    "ID": 1,
                    "CONFERENCE_ID": 1,
                    "STATUS": "checked-in",
                    "QR_CODE": "REG-1-5-16D7106113",
                    "REGISTRATION_DATE": "2025-09-02T16:23:23.873Z"
                }
            ];
            
            const result = calculateOverallStatus(registrations);
            const resultDiv = document.getElementById('result1');
            resultDiv.innerHTML = `
                <strong>K·∫øt qu·∫£:</strong> ${getStatusBadge(result)}<br>
                <strong>Expected:</strong> ${getStatusBadge('checked-in')}<br>
                <strong>Status:</strong> ${result === 'checked-in' ? '‚úÖ PASS' : '‚ùå FAIL'}
            `;
            resultDiv.className = `result ${result === 'checked-in' ? 'success' : 'error'}`;
            resultDiv.style.display = 'block';
        }

        function testMultipleRegistrations() {
            const registrations = [
                {
                    "ID": 1,
                    "CONFERENCE_ID": 1,
                    "STATUS": "registered",
                    "QR_CODE": "REG-1-5-16D7106113",
                    "REGISTRATION_DATE": "2025-09-01T10:00:00.000Z"
                },
                {
                    "ID": 2,
                    "CONFERENCE_ID": 1,
                    "STATUS": "checked-in",
                    "QR_CODE": "REG-2-5-16D7106114",
                    "REGISTRATION_DATE": "2025-09-02T16:23:23.873Z"
                }
            ];
            
            const result = calculateOverallStatus(registrations);
            const resultDiv = document.getElementById('result2');
            resultDiv.innerHTML = `
                <strong>K·∫øt qu·∫£:</strong> ${getStatusBadge(result)}<br>
                <strong>Expected:</strong> ${getStatusBadge('checked-in')} (latest registration)<br>
                <strong>Status:</strong> ${result === 'checked-in' ? '‚úÖ PASS' : '‚ùå FAIL'}
            `;
            resultDiv.className = `result ${result === 'checked-in' ? 'success' : 'error'}`;
            resultDiv.style.display = 'block';
        }

        function testCheckedOutStatus() {
            const registrations = [
                {
                    "ID": 1,
                    "CONFERENCE_ID": 1,
                    "STATUS": "checked-out",
                    "QR_CODE": "REG-1-5-16D7106113",
                    "REGISTRATION_DATE": "2025-09-02T18:30:00.000Z"
                }
            ];
            
            const result = calculateOverallStatus(registrations);
            const resultDiv = document.getElementById('result3');
            resultDiv.innerHTML = `
                <strong>K·∫øt qu·∫£:</strong> ${getStatusBadge(result)}<br>
                <strong>Expected:</strong> ${getStatusBadge('checked-out')}<br>
                <strong>Status:</strong> ${result === 'checked-out' ? '‚úÖ PASS' : '‚ùå FAIL'}
            `;
            resultDiv.className = `result ${result === 'checked-out' ? 'success' : 'error'}`;
            resultDiv.style.display = 'block';
        }

        function testNoRegistrations() {
            const registrations = [];
            
            const result = calculateOverallStatus(registrations);
            const resultDiv = document.getElementById('result4');
            resultDiv.innerHTML = `
                <strong>K·∫øt qu·∫£:</strong> ${getStatusBadge(result)}<br>
                <strong>Expected:</strong> ${getStatusBadge('not-registered')} (no registrations)<br>
                <strong>Status:</strong> ${result === 'not-registered' ? '‚úÖ PASS' : '‚ùå FAIL'}
            `;
            resultDiv.className = `result ${result === 'not-registered' ? 'success' : 'error'}`;
            resultDiv.style.display = 'block';
        }

        // Auto-run tests on page load
        window.onload = function() {
            console.log('üß™ Running checkin status fix tests...');
        };
    </script>
</body>
</html>
