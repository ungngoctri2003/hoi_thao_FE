"use client"

import { useState, useEffect } from "react"
import { Card, CardContent } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Progress } from "@/components/ui/progress"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import { Award, Trophy, Star, Target } from "lucide-react"
import BadgeCard from "./badge-card"
import CertificateGenerator from "./certificate-generator"
import AchievementTracker from "./achievement-tracker"

interface UserBadge {
  id: string
  name: string
  description: string
  icon: string
  category: "participation" | "engagement" | "networking" | "learning" | "special"
  rarity: "common" | "rare" | "epic" | "legendary"
  earnedAt?: Date
  progress?: number
  maxProgress?: number
  requirements: string[]
  points: number
}

interface UserStats {
  totalBadges: number
  totalPoints: number
  level: number
  nextLevelPoints: number
  currentLevelPoints: number
  rank: number
  totalUsers: number
}

export default function BadgeSystem() {
  const [badges, setBadges] = useState<UserBadge[]>([])
  const [userStats, setUserStats] = useState<UserStats | null>(null)
  const [selectedCategory, setSelectedCategory] = useState<string>("all")
  const [showEarnedOnly, setShowEarnedOnly] = useState(false)

  useEffect(() => {
    // Simulate badge data
    const mockBadges: UserBadge[] = [
      {
        id: "early-bird",
        name: "Ng∆∞·ªùi ƒë·∫øn s·ªõm",
        description: "ƒêƒÉng k√Ω tham d·ª± h·ªôi ngh·ªã trong 24 gi·ªù ƒë·∫ßu",
        icon: "üê¶",
        category: "participation",
        rarity: "common",
        earnedAt: new Date(Date.now() - 86400000 * 5),
        requirements: ["ƒêƒÉng k√Ω trong 24 gi·ªù ƒë·∫ßu"],
        points: 50,
      },
      {
        id: "session-master",
        name: "B·∫≠c th·∫ßy phi√™n h·ªçp",
        description: "Tham d·ª± √≠t nh·∫•t 10 phi√™n h·ªçp",
        icon: "üéØ",
        category: "participation",
        rarity: "rare",
        earnedAt: new Date(Date.now() - 86400000 * 2),
        requirements: ["Tham d·ª± 10 phi√™n h·ªçp"],
        points: 150,
      },
      {
        id: "networking-pro",
        name: "Chuy√™n gia k·∫øt n·ªëi",
        description: "K·∫øt n·ªëi v·ªõi 25 ng∆∞·ªùi tham d·ª± kh√°c",
        icon: "ü§ù",
        category: "networking",
        rarity: "rare",
        progress: 18,
        maxProgress: 25,
        requirements: ["K·∫øt n·ªëi v·ªõi 25 ng∆∞·ªùi"],
        points: 200,
      },
      {
        id: "qa-champion",
        name: "Nh√† v√¥ ƒë·ªãch Q&A",
        description: "ƒê·∫∑t 5 c√¢u h·ªèi ƒë∆∞·ª£c upvote nhi·ªÅu nh·∫•t",
        icon: "‚ùì",
        category: "engagement",
        rarity: "epic",
        progress: 3,
        maxProgress: 5,
        requirements: ["5 c√¢u h·ªèi top upvote"],
        points: 300,
      },
      {
        id: "poll-participant",
        name: "Ng∆∞·ªùi tham gia b√¨nh ch·ªçn",
        description: "Tham gia 15 cu·ªôc b√¨nh ch·ªçn tr·ª±c ti·∫øp",
        icon: "üìä",
        category: "engagement",
        rarity: "common",
        earnedAt: new Date(Date.now() - 86400000 * 1),
        requirements: ["Tham gia 15 cu·ªôc b√¨nh ch·ªçn"],
        points: 75,
      },
      {
        id: "feedback-guru",
        name: "Guru ph·∫£n h·ªìi",
        description: "ƒê√°nh gi√° 20 phi√™n h·ªçp v·ªõi nh·∫≠n x√©t chi ti·∫øt",
        icon: "‚≠ê",
        category: "engagement",
        rarity: "rare",
        progress: 12,
        maxProgress: 20,
        requirements: ["ƒê√°nh gi√° 20 phi√™n h·ªçp"],
        points: 180,
      },
      {
        id: "knowledge-seeker",
        name: "Ng∆∞·ªùi t√¨m ki·∫øm tri th·ª©c",
        description: "Ho√†n th√†nh 5 workshop hands-on",
        icon: "üìö",
        category: "learning",
        rarity: "epic",
        progress: 2,
        maxProgress: 5,
        requirements: ["Ho√†n th√†nh 5 workshop"],
        points: 250,
      },
      {
        id: "conference-legend",
        name: "Huy·ªÅn tho·∫°i h·ªôi ngh·ªã",
        description: "ƒê·∫°t t·∫•t c·∫£ huy hi·ªáu kh√°c v√† tham gia ƒë·∫ßy ƒë·ªß",
        icon: "üëë",
        category: "special",
        rarity: "legendary",
        progress: 6,
        maxProgress: 10,
        requirements: ["ƒê·∫°t t·∫•t c·∫£ huy hi·ªáu kh√°c", "Tham gia ƒë·∫ßy ƒë·ªß 3 ng√†y"],
        points: 1000,
      },
    ]

    setBadges(mockBadges)

    // Calculate user stats
    const earnedBadges = mockBadges.filter((b) => b.earnedAt)
    const totalPoints = earnedBadges.reduce((sum, badge) => sum + badge.points, 0)
    const level = Math.floor(totalPoints / 500) + 1
    const currentLevelPoints = totalPoints % 500
    const nextLevelPoints = 500

    setUserStats({
      totalBadges: earnedBadges.length,
      totalPoints,
      level,
      nextLevelPoints,
      currentLevelPoints,
      rank: 23,
      totalUsers: 1247,
    })
  }, [])

  const filteredBadges = badges.filter((badge) => {
    const categoryMatch = selectedCategory === "all" || badge.category === selectedCategory
    const earnedMatch = !showEarnedOnly || badge.earnedAt
    return categoryMatch && earnedMatch
  })

  const categories = [
    { value: "all", label: "T·∫•t c·∫£", icon: "üèÜ" },
    { value: "participation", label: "Tham gia", icon: "üéØ" },
    { value: "engagement", label: "T∆∞∆°ng t√°c", icon: "üí¨" },
    { value: "networking", label: "K·∫øt n·ªëi", icon: "ü§ù" },
    { value: "learning", label: "H·ªçc t·∫≠p", icon: "üìö" },
    { value: "special", label: "ƒê·∫∑c bi·ªát", icon: "‚≠ê" },
  ]

  const getRarityColor = (rarity: string) => {
    switch (rarity) {
      case "common":
        return "text-gray-600 dark:text-gray-400"
      case "rare":
        return "text-blue-600 dark:text-blue-400"
      case "epic":
        return "text-purple-600 dark:text-purple-400"
      case "legendary":
        return "text-yellow-600 dark:text-yellow-400"
      default:
        return "text-gray-600 dark:text-gray-400"
    }
  }

  const getRarityBg = (rarity: string) => {
    switch (rarity) {
      case "common":
        return "bg-gray-100 dark:bg-gray-800"
      case "rare":
        return "bg-blue-100 dark:bg-blue-900/20"
      case "epic":
        return "bg-purple-100 dark:bg-purple-900/20"
      case "legendary":
        return "bg-yellow-100 dark:bg-yellow-900/20"
      default:
        return "bg-gray-100 dark:bg-gray-800"
    }
  }

  if (!userStats) {
    return <div>ƒêang t·∫£i...</div>
  }

  return (
    <div className="space-y-6">
      {/* User Stats */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
        <Card>
          <CardContent className="p-4">
            <div className="flex items-center space-x-2">
              <Award className="h-5 w-5 text-yellow-500" />
              <div>
                <p className="text-sm text-gray-600 dark:text-gray-400">Huy hi·ªáu ƒë·∫°t ƒë∆∞·ª£c</p>
                <p className="text-2xl font-bold">{userStats.totalBadges}</p>
              </div>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-4">
            <div className="flex items-center space-x-2">
              <Star className="h-5 w-5 text-blue-500" />
              <div>
                <p className="text-sm text-gray-600 dark:text-gray-400">T·ªïng ƒëi·ªÉm</p>
                <p className="text-2xl font-bold">{userStats.totalPoints}</p>
              </div>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-4">
            <div className="flex items-center space-x-2">
              <Trophy className="h-5 w-5 text-green-500" />
              <div>
                <p className="text-sm text-gray-600 dark:text-gray-400">C·∫•p ƒë·ªô</p>
                <p className="text-2xl font-bold">{userStats.level}</p>
              </div>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-4">
            <div className="flex items-center space-x-2">
              <Target className="h-5 w-5 text-purple-500" />
              <div>
                <p className="text-sm text-gray-600 dark:text-gray-400">X·∫øp h·∫°ng</p>
                <p className="text-2xl font-bold">
                  #{userStats.rank}/{userStats.totalUsers}
                </p>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Level Progress */}
      <Card>
        <CardContent className="p-4">
          <div className="flex items-center justify-between mb-2">
            <h3 className="font-semibold">Ti·∫øn ƒë·ªô c·∫•p ƒë·ªô {userStats.level}</h3>
            <span className="text-sm text-gray-600 dark:text-gray-400">
              {userStats.currentLevelPoints}/{userStats.nextLevelPoints} ƒëi·ªÉm
            </span>
          </div>
          <Progress value={(userStats.currentLevelPoints / userStats.nextLevelPoints) * 100} className="h-3" />
          <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">
            C√≤n {userStats.nextLevelPoints - userStats.currentLevelPoints} ƒëi·ªÉm ƒë·ªÉ l√™n c·∫•p {userStats.level + 1}
          </p>
        </CardContent>
      </Card>

      <Tabs defaultValue="badges" className="w-full">
        <TabsList className="grid w-full grid-cols-3">
          <TabsTrigger value="badges">Huy hi·ªáu</TabsTrigger>
          <TabsTrigger value="achievements">Th√†nh t√≠ch</TabsTrigger>
          <TabsTrigger value="certificates">Ch·ª©ng ch·ªâ</TabsTrigger>
        </TabsList>

        <TabsContent value="badges" className="space-y-4">
          {/* Filters */}
          <div className="flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between">
            <div className="flex flex-wrap gap-2">
              {categories.map((category) => (
                <Button
                  key={category.value}
                  variant={selectedCategory === category.value ? "default" : "outline"}
                  size="sm"
                  onClick={() => setSelectedCategory(category.value)}
                  className="flex items-center space-x-1"
                >
                  <span>{category.icon}</span>
                  <span>{category.label}</span>
                </Button>
              ))}
            </div>

            <div className="flex items-center space-x-4">
              <Button
                variant={showEarnedOnly ? "default" : "outline"}
                size="sm"
                onClick={() => setShowEarnedOnly(!showEarnedOnly)}
              >
                Ch·ªâ huy hi·ªáu ƒë√£ ƒë·∫°t
              </Button>
            </div>
          </div>

          {/* Badges Grid */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {filteredBadges.map((badge) => (
              <BadgeCard key={badge.id} badge={badge} />
            ))}
          </div>

          {filteredBadges.length === 0 && (
            <Card>
              <CardContent className="p-8 text-center">
                <Award className="h-12 w-12 text-gray-400 mx-auto mb-4" />
                <h3 className="text-lg font-semibold mb-2">Kh√¥ng t√¨m th·∫•y huy hi·ªáu</h3>
                <p className="text-gray-600 dark:text-gray-400">Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ƒë·ªÉ xem th√™m huy hi·ªáu</p>
              </CardContent>
            </Card>
          )}
        </TabsContent>

        <TabsContent value="achievements">
          <AchievementTracker badges={badges} userStats={userStats} />
        </TabsContent>

        <TabsContent value="certificates">
          <CertificateGenerator badges={badges.filter((b) => b.earnedAt)} userStats={userStats} />
        </TabsContent>
      </Tabs>
    </div>
  )
}
