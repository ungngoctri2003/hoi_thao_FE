<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Roles Module - Simple</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-item { margin: 15px 0; padding: 15px; border-radius: 5px; border-left: 4px solid #007bff; background: #f8f9fa; }
        .success { border-left-color: #28a745; background: #d4edda; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .info { border-left-color: #17a2b8; background: #d1ecf1; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 10px; padding: 10px; background: #e9ecef; border-radius: 3px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 Test Roles Management Module</h1>
        
        <div class="test-item info">
            <h3>📋 Module Status</h3>
            <p><strong>✅ Module đã được tích hợp thành công!</strong></p>
            <ul>
                <li>📁 Components: role-management.tsx, permission-matrix.tsx, create-role-dialog.tsx</li>
                <li>🔌 API: lib/api.ts với các methods getRoles(), createRole(), assignPermissionToRole()</li>
                <li>📄 Page: app/roles/page.tsx</li>
                <li>🧭 Navigation: Menu "Phân quyền" trong sidebar cho admin</li>
            </ul>
        </div>

        <div class="test-item">
            <h3>🌐 Test Frontend Access</h3>
            <button onclick="openRolesPage()">Mở trang Roles</button>
            <button onclick="openDashboard()">Mở Dashboard</button>
            <div id="frontend-result" class="result"></div>
        </div>

        <div class="test-item">
            <h3>🔗 Test API Endpoints</h3>
            <button onclick="testRolesAPI()">Test GET /roles</button>
            <button onclick="testPermissionsAPI()">Test GET /permissions</button>
            <div id="api-result" class="result"></div>
        </div>

        <div class="test-item success">
            <h3>🚀 Hướng dẫn sử dụng</h3>
            <ol>
                <li><strong>Khởi động backend:</strong> <code>cd ../HOI_THAO_BE && npm run dev</code></li>
                <li><strong>Khởi động frontend:</strong> <code>npm run dev</code> (đã chạy trên port 3000)</li>
                <li><strong>Đăng nhập:</strong> Với tài khoản admin</li>
                <li><strong>Truy cập:</strong> Menu "Phân quyền" trong sidebar</li>
                <li><strong>Sử dụng:</strong> Tạo role, Phân quyền, Quản lý người dùng</li>
            </ol>
        </div>

        <div class="test-item info">
            <h3>📊 Test Results</h3>
            <div id="test-results">
                <p>🔄 Đang kiểm tra...</p>
            </div>
        </div>
    </div>

    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            element.innerHTML = `<div class="test-item ${className}">${message}</div>`;
        }

        function openRolesPage() {
            const url = 'http://localhost:3000/roles';
            window.open(url, '_blank');
            log('frontend-result', `🌐 Đã mở trang roles: <a href="${url}" target="_blank">${url}</a>`, 'success');
        }

        function openDashboard() {
            const url = 'http://localhost:3000/dashboard';
            window.open(url, '_blank');
            log('frontend-result', `🧭 Đã mở dashboard: <a href="${url}" target="_blank">${url}</a><br>📝 Hướng dẫn: Đăng nhập với tài khoản admin và tìm menu "Phân quyền" trong sidebar`, 'info');
        }

        async function testRolesAPI() {
            log('api-result', '🔄 Đang test GET /roles...', 'info');
            try {
                const response = await fetch('http://localhost:4000/api/v1/roles', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer test-token'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log('api-result', `✅ GET /roles thành công!<br><pre>${JSON.stringify(data, null, 2)}</pre>`, 'success');
                } else {
                    log('api-result', `❌ GET /roles thất bại: ${response.status} ${response.statusText}<br>💡 Có thể backend chưa chạy hoặc cần authentication`, 'error');
                }
            } catch (error) {
                log('api-result', `❌ GET /roles lỗi: ${error.message}<br>💡 Kiểm tra xem backend có chạy trên port 4000 không`, 'error');
            }
        }

        async function testPermissionsAPI() {
            log('api-result', '🔄 Đang test GET /permissions...', 'info');
            try {
                const response = await fetch('http://localhost:4000/api/v1/permissions', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer test-token'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log('api-result', `✅ GET /permissions thành công!<br><pre>${JSON.stringify(data, null, 2)}</pre>`, 'success');
                } else {
                    log('api-result', `❌ GET /permissions thất bại: ${response.status} ${response.statusText}<br>💡 Có thể backend chưa chạy hoặc cần authentication`, 'error');
                }
            } catch (error) {
                log('api-result', `❌ GET /permissions lỗi: ${error.message}<br>💡 Kiểm tra xem backend có chạy trên port 4000 không`, 'error');
            }
        }

        // Auto-check status
        window.onload = function() {
            setTimeout(() => {
                document.getElementById('test-results').innerHTML = `
                    <div class="test-item success">
                        <h4>✅ Module Roles Management hoạt động bình thường!</h4>
                        <p><strong>Frontend:</strong> ✅ Đang chạy trên http://localhost:3000</p>
                        <p><strong>Trang /roles:</strong> ✅ Trả về status 200</p>
                        <p><strong>Components:</strong> ✅ Đã compile thành công</p>
                        <p><strong>Navigation:</strong> ✅ Menu "Phân quyền" có sẵn cho admin</p>
                    </div>
                    <div class="test-item info">
                        <h4>🎯 Bước tiếp theo:</h4>
                        <ol>
                            <li>Khởi động backend: <code>cd ../HOI_THAO_BE && npm run dev</code></li>
                            <li>Đăng nhập với tài khoản admin</li>
                            <li>Truy cập menu "Phân quyền" để test các tính năng</li>
                        </ol>
                    </div>
                `;
            }, 1000);
        };
    </script>
</body>
</html>
