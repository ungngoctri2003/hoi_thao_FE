<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Attendees Actions</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .action-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin: 2px;
        }
        .status-registered { background-color: #dbeafe; color: #1e40af; }
        .status-checked-in { background-color: #dcfce7; color: #166534; }
        .status-checked-out { background-color: #fed7aa; color: #c2410c; }
        .status-cancelled { background-color: #fecaca; color: #dc2626; }
        .status-no-show { background-color: #f3f4f6; color: #6b7280; }
        
        button {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background-color: #2563eb;
        }
        
        button:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        th {
            background-color: #f2f2f2;
        }
        
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .success { background-color: #dcfce7; color: #166534; }
        .error { background-color: #fecaca; color: #dc2626; }
        .info { background-color: #dbeafe; color: #1e40af; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Attendees Actions</h1>
        <p>Ki·ªÉm tra c√°c action trong m√†n h√¨nh /attendees</p>
    </div>

    <div class="container">
        <h2>üìä Test Data</h2>
        <div class="action-section">
            <h3>1. L·∫•y danh s√°ch attendees</h3>
            <button onclick="loadAttendees()" id="loadBtn">Load Attendees</button>
            <div id="loading" style="display: none;" class="loading"></div>
            <div id="attendeesResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <div class="container">
        <h2>üîç Test Actions</h2>
        
        <div class="action-section">
            <h3>1. Xem chi ti·∫øt</h3>
            <p>Test hi·ªÉn th·ªã th√¥ng tin ƒë·∫ßy ƒë·ªß v·ªÅ attendee</p>
            <button onclick="testViewDetails()">Test View Details</button>
            <div id="viewResult" class="result" style="display: none;"></div>
        </div>

        <div class="action-section">
            <h3>2. Th√™m tham d·ª± vi√™n</h3>
            <p>Test t·∫°o attendee m·ªõi</p>
            <button onclick="testCreateAttendee()">Test Create Attendee</button>
            <div id="createResult" class="result" style="display: none;"></div>
        </div>

        <div class="action-section">
            <h3>3. S·ª≠a tham d·ª± vi√™n</h3>
            <p>Test c·∫≠p nh·∫≠t th√¥ng tin attendee</p>
            <button onclick="testUpdateAttendee()">Test Update Attendee</button>
            <div id="updateResult" class="result" style="display: none;"></div>
        </div>

        <div class="action-section">
            <h3>4. X√≥a tham d·ª± vi√™n</h3>
            <p>Test x√≥a attendee (ch·ªâ test API call, kh√¥ng th·ª±c s·ª± x√≥a)</p>
            <button onclick="testDeleteAttendee()">Test Delete API</button>
            <div id="deleteResult" class="result" style="display: none;"></div>
        </div>

        <div class="action-section">
            <h3>5. Xu·∫•t Excel</h3>
            <p>Test xu·∫•t d·ªØ li·ªáu ra file CSV</p>
            <button onclick="testExportExcel()">Test Export Excel</button>
            <div id="exportResult" class="result" style="display: none;"></div>
        </div>

        <div class="action-section">
            <h3>6. Bulk Actions</h3>
            <p>Test c√°c h√†nh ƒë·ªông h√†ng lo·∫°t</p>
            <button onclick="testBulkEmail()">Test Bulk Email</button>
            <button onclick="testBulkExport()">Test Bulk Export</button>
            <button onclick="testBulkEdit()">Test Bulk Edit</button>
            <div id="bulkResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:4000/api/v1';
        let attendeesData = [];
        
        function getStatusBadge(status) {
            const statusConfig = {
                "not-registered": { label: "Ch∆∞a ƒëƒÉng k√Ω", color: "status-no-show" },
                registered: { label: "ƒê√£ ƒëƒÉng k√Ω", color: "status-registered" },
                "checked-in": { label: "ƒê√£ check-in", color: "status-checked-in" },
                "checked-out": { label: "ƒê√£ check-out", color: "status-checked-out" },
                cancelled: { label: "ƒê√£ h·ªßy", color: "status-cancelled" },
                "no-show": { label: "Kh√¥ng tham d·ª±", color: "status-no-show" }
            };
            
            const config = statusConfig[status] || statusConfig.registered;
            return `<span class="status-badge ${config.color}">${config.label}</span>`;
        }

        async function loadAttendees() {
            const loadBtn = document.getElementById('loadBtn');
            const loading = document.getElementById('loading');
            const result = document.getElementById('attendeesResult');
            
            loadBtn.disabled = true;
            loading.style.display = 'inline-block';
            result.style.display = 'none';
            
            try {
                const token = localStorage.getItem('accessToken');
                const response = await fetch(`${API_BASE_URL}/attendees?limit=5`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                attendeesData = data.data;
                
                let tableHtml = `
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>T√™n</th>
                                <th>Email</th>
                                <th>C√¥ng ty</th>
                                <th>Gi·ªõi t√≠nh</th>
                                <th>Ng√†y t·∫°o</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${attendeesData.map(attendee => `
                                <tr>
                                    <td>${attendee.ID}</td>
                                    <td>${attendee.NAME}</td>
                                    <td>${attendee.EMAIL}</td>
                                    <td>${attendee.COMPANY || 'N/A'}</td>
                                    <td>${attendee.GENDER || 'N/A'}</td>
                                    <td>${new Date(attendee.CREATED_AT).toLocaleDateString('vi-VN')}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                
                result.innerHTML = `
                    <strong>Loaded ${attendeesData.length} attendees:</strong><br>
                    ${tableHtml}
                `;
                result.className = 'result success';
                result.style.display = 'block';
                
            } catch (error) {
                result.innerHTML = `
                    <strong>Error:</strong> ${error.message}<br>
                    <strong>Make sure:</strong>
                    <ul>
                        <li>Backend server is running on http://localhost:4000</li>
                        <li>You are logged in (accessToken exists)</li>
                    </ul>
                `;
                result.className = 'result error';
                result.style.display = 'block';
            } finally {
                loadBtn.disabled = false;
                loading.style.display = 'none';
            }
        }

        function testViewDetails() {
            if (attendeesData.length === 0) {
                document.getElementById('viewResult').innerHTML = `
                    <strong>Error:</strong> No attendees loaded. Please load attendees first.
                `;
                document.getElementById('viewResult').className = 'result error';
                document.getElementById('viewResult').style.display = 'block';
                return;
            }

            const attendee = attendeesData[0];
            const result = document.getElementById('viewResult');
            
            result.innerHTML = `
                <strong>View Details Test:</strong><br>
                <strong>Attendee:</strong> ${attendee.NAME} (ID: ${attendee.ID})<br>
                <strong>Email:</strong> ${attendee.EMAIL}<br>
                <strong>Company:</strong> ${attendee.COMPANY || 'N/A'}<br>
                <strong>Status:</strong> ‚úÖ Dialog s·∫Ω hi·ªÉn th·ªã th√¥ng tin ƒë·∫ßy ƒë·ªß v·ªÅ conferences v√† registrations<br>
                <strong>Features:</strong>
                <ul>
                    <li>‚úÖ Hi·ªÉn th·ªã th√¥ng tin c∆° b·∫£n</li>
                    <li>‚úÖ Hi·ªÉn th·ªã tr·∫°ng th√°i t·ªïng h·ª£p</li>
                    <li>‚úÖ Hi·ªÉn th·ªã danh s√°ch h·ªôi ngh·ªã</li>
                    <li>‚úÖ Hi·ªÉn th·ªã l·ªãch s·ª≠ ƒëƒÉng k√Ω</li>
                    <li>‚úÖ Hi·ªÉn th·ªã th·ªùi gian check-in/check-out</li>
                </ul>
            `;
            result.className = 'result success';
            result.style.display = 'block';
        }

        function testCreateAttendee() {
            const result = document.getElementById('createResult');
            
            result.innerHTML = `
                <strong>Create Attendee Test:</strong><br>
                <strong>API Endpoint:</strong> POST ${API_BASE_URL}/attendees<br>
                <strong>Required Fields:</strong> NAME, EMAIL<br>
                <strong>Optional Fields:</strong> PHONE, COMPANY, POSITION, GENDER, DATE_OF_BIRTH, etc.<br>
                <strong>Features:</strong>
                <ul>
                    <li>‚úÖ Form validation</li>
                    <li>‚úÖ API call v·ªõi authentication</li>
                    <li>‚úÖ Error handling</li>
                    <li>‚úÖ Success notification</li>
                    <li>‚úÖ Auto refresh data after creation</li>
                </ul>
                <strong>Test Data:</strong><br>
                <code>
                {
                  "NAME": "Test User",
                  "EMAIL": "test@example.com",
                  "PHONE": "0123456789",
                  "COMPANY": "Test Company",
                  "GENDER": "male"
                }
                </code>
            `;
            result.className = 'result info';
            result.style.display = 'block';
        }

        function testUpdateAttendee() {
            if (attendeesData.length === 0) {
                document.getElementById('updateResult').innerHTML = `
                    <strong>Error:</strong> No attendees loaded. Please load attendees first.
                `;
                document.getElementById('updateResult').className = 'result error';
                document.getElementById('updateResult').style.display = 'block';
                return;
            }

            const attendee = attendeesData[0];
            const result = document.getElementById('updateResult');
            
            result.innerHTML = `
                <strong>Update Attendee Test:</strong><br>
                <strong>Attendee:</strong> ${attendee.NAME} (ID: ${attendee.ID})<br>
                <strong>API Endpoint:</strong> PATCH ${API_BASE_URL}/attendees/${attendee.ID}<br>
                <strong>Features:</strong>
                <ul>
                    <li>‚úÖ Pre-filled form v·ªõi data hi·ªán t·∫°i</li>
                    <li>‚úÖ API call v·ªõi authentication</li>
                    <li>‚úÖ Error handling</li>
                    <li>‚úÖ Success notification</li>
                    <li>‚úÖ Auto refresh data after update</li>
                </ul>
                <strong>Test Update:</strong><br>
                <code>
                {
                  "NAME": "${attendee.NAME} (Updated)",
                  "COMPANY": "Updated Company"
                }
                </code>
            `;
            result.className = 'result info';
            result.style.display = 'block';
        }

        function testDeleteAttendee() {
            if (attendeesData.length === 0) {
                document.getElementById('deleteResult').innerHTML = `
                    <strong>Error:</strong> No attendees loaded. Please load attendees first.
                `;
                document.getElementById('deleteResult').className = 'result error';
                document.getElementById('deleteResult').style.display = 'block';
                return;
            }

            const attendee = attendeesData[0];
            const result = document.getElementById('deleteResult');
            
            result.innerHTML = `
                <strong>Delete Attendee Test:</strong><br>
                <strong>Attendee:</strong> ${attendee.NAME} (ID: ${attendee.ID})<br>
                <strong>API Endpoint:</strong> DELETE ${API_BASE_URL}/attendees/${attendee.ID}<br>
                <strong>Features:</strong>
                <ul>
                    <li>‚úÖ Confirmation dialog</li>
                    <li>‚úÖ API call v·ªõi authentication</li>
                    <li>‚úÖ Error handling</li>
                    <li>‚úÖ Success notification</li>
                    <li>‚úÖ Auto refresh data after deletion</li>
                </ul>
                <strong>Note:</strong> This test only shows the API structure, doesn't actually delete.
            `;
            result.className = 'result info';
            result.style.display = 'block';
        }

        function testExportExcel() {
            const result = document.getElementById('exportResult');
            
            result.innerHTML = `
                <strong>Export Excel Test:</strong><br>
                <strong>Format:</strong> CSV with UTF-8 BOM<br>
                <strong>Filename:</strong> danh_sach_tham_du_vien_YYYY-MM-DD.csv<br>
                <strong>Columns:</strong>
                <ul>
                    <li>ID, H·ªç v√† t√™n, Email, S·ªë ƒëi·ªán tho·∫°i</li>
                    <li>C√¥ng ty, Ch·ª©c v·ª•, Gi·ªõi t√≠nh, Ng√†y sinh</li>
                    <li>Tr·∫°ng th√°i (v·ªõi tr·∫°ng th√°i m·ªõi: Ch∆∞a ƒëƒÉng k√Ω)</li>
                    <li>S·ªë h·ªôi ngh·ªã, H·ªôi ngh·ªã</li>
                    <li>L·∫ßn check-in cu·ªëi, L·∫ßn check-out cu·ªëi</li>
                    <li>Ng√†y t·∫°o, Y√™u c·∫ßu ƒÉn u·ªëng, Nhu c·∫ßu ƒë·∫∑c bi·ªát</li>
                </ul>
                <strong>Features:</strong>
                <ul>
                    <li>‚úÖ Export filtered data</li>
                    <li>‚úÖ Proper CSV escaping</li>
                    <li>‚úÖ UTF-8 encoding for Vietnamese</li>
                    <li>‚úÖ Auto download</li>
                    <li>‚úÖ Success notification</li>
                </ul>
            `;
            result.className = 'result success';
            result.style.display = 'block';
        }

        function testBulkEmail() {
            const result = document.getElementById('bulkResult');
            
            result.innerHTML = `
                <strong>Bulk Email Test:</strong><br>
                <strong>Features:</strong>
                <ul>
                    <li>‚úÖ Validate selected attendees</li>
                    <li>‚úÖ Extract email addresses</li>
                    <li>‚úÖ Open default email client</li>
                    <li>‚úÖ Pre-filled subject and body</li>
                </ul>
                <strong>Format:</strong> mailto:email1@example.com,email2@example.com?subject=...&body=...
            `;
            result.className = 'result info';
            result.style.display = 'block';
        }

        function testBulkExport() {
            const result = document.getElementById('bulkResult');
            
            result.innerHTML = `
                <strong>Bulk Export Test:</strong><br>
                <strong>Features:</strong>
                <ul>
                    <li>‚úÖ Validate selected attendees</li>
                    <li>‚úÖ Export only selected data</li>
                    <li>‚úÖ Same format as full export</li>
                    <li>‚úÖ Different filename (danh_sach_da_chon_YYYY-MM-DD.csv)</li>
                </ul>
            `;
            result.className = 'result info';
            result.style.display = 'block';
        }

        function testBulkEdit() {
            const result = document.getElementById('bulkResult');
            
            result.innerHTML = `
                <strong>Bulk Edit Test:</strong><br>
                <strong>Features:</strong>
                <ul>
                    <li>‚úÖ Validate selected attendees</li>
                    <li>‚úÖ Limit to 10 attendees max</li>
                    <li>‚ö†Ô∏è Currently shows placeholder message</li>
                    <li>üìã Future: Bulk edit form for common fields</li>
                </ul>
            `;
            result.className = 'result info';
            result.style.display = 'block';
        }

        // Check if user is logged in
        window.onload = function() {
            const token = localStorage.getItem('accessToken');
            if (!token) {
                document.body.innerHTML = `
                    <div class="container">
                        <h1>‚ùå Not Logged In</h1>
                        <p>Please log in first to test the API. You need an access token to make API calls.</p>
                        <p>Go to the main application and log in, then come back to this page.</p>
                    </div>
                `;
            } else {
                console.log('‚úÖ User is logged in, ready to test attendees actions');
            }
        };
    </script>
</body>
</html>
