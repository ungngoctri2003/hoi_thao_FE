<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Conference Permissions</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        .debug-section {
            margin: 20px 0;
            padding: 16px;
            border: 1px solid #e5e5e5;
            border-radius: 6px;
        }
        .debug-title {
            font-weight: 600;
            margin-bottom: 12px;
            color: #111827;
        }
        .debug-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        .debug-item:last-child {
            border-bottom: none;
        }
        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .status.pass {
            background: #dcfce7;
            color: #166534;
        }
        .status.fail {
            background: #fef2f2;
            color: #dc2626;
        }
        .status.pending {
            background: #fef3c7;
            color: #d97706;
        }
        .code-block {
            background: #f9fafb;
            padding: 16px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
            margin: 12px 0;
            border-left: 4px solid #3b82f6;
            white-space: pre-wrap;
        }
        .error-block {
            background: #fef2f2;
            border-left-color: #dc2626;
        }
        .success-block {
            background: #f0fdf4;
            border-left-color: #16a34a;
        }
        .btn {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-size: 14px;
            margin: 4px;
        }
        .btn:hover {
            background: #f9fafb;
        }
        .btn-primary {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        .btn-primary:hover {
            background: #2563eb;
        }
        .log-container {
            max-height: 300px;
            overflow-y: auto;
            background: #1f2937;
            color: #f9fafb;
            padding: 12px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Debug Conference Permissions</h1>
        <p>Ki·ªÉm tra t·∫°i sao navbar kh√¥ng hi·ªÉn th·ªã h·ªôi ngh·ªã v√† quy·ªÅn</p>

        <div class="debug-section">
            <div class="debug-title">Debug Steps</div>
            <button class="btn btn-primary" onclick="testAuth()">1. Test Authentication</button>
            <button class="btn btn-primary" onclick="testAPI()">2. Test API Call</button>
            <button class="btn btn-primary" onclick="testHook()">3. Test Hook</button>
            <button class="btn btn-primary" onclick="testUI()">4. Test UI Display</button>
        </div>

        <div class="debug-section">
            <div class="debug-title">Debug Logs</div>
            <div id="debug-logs" class="log-container">
                <div>Click buttons above to start debugging...</div>
            </div>
        </div>

        <div class="debug-section">
            <div class="debug-title">Possible Issues</div>
            <div class="debug-item">
                <span>1. User ch∆∞a ƒë∆∞·ª£c ph√¢n quy·ªÅn h·ªôi ngh·ªã trong database</span>
                <span class="status pending">CHECK</span>
            </div>
            <div class="debug-item">
                <span>2. API endpoint kh√¥ng ho·∫°t ƒë·ªông ho·∫∑c tr·∫£ v·ªÅ empty</span>
                <span class="status pending">CHECK</span>
            </div>
            <div class="debug-item">
                <span>3. Hook kh√¥ng ƒë∆∞·ª£c g·ªçi ho·∫∑c c√≥ l·ªói</span>
                <span class="status pending">CHECK</span>
            </div>
            <div class="debug-item">
                <span>4. UI component kh√¥ng render ƒë√∫ng</span>
                <span class="status pending">CHECK</span>
            </div>
            <div class="debug-item">
                <span>5. Authentication state kh√¥ng ƒë√∫ng</span>
                <span class="status pending">CHECK</span>
            </div>
        </div>

        <div class="debug-section">
            <div class="debug-title">Quick Fixes</div>
            <div class="code-block">
// 1. Ki·ªÉm tra user c√≥ ƒë∆∞·ª£c ph√¢n quy·ªÅn h·ªôi ngh·ªã kh√¥ng
SELECT * FROM user_conference_assignments WHERE user_id = [USER_ID];

// 2. T·∫°o d·ªØ li·ªáu m·∫´u n·∫øu c·∫ßn
INSERT INTO user_conference_assignments (user_id, conference_id, permissions, is_active) 
VALUES (1, 1, '{"conferences.view": true, "attendees.view": true}', 1);

// 3. Ki·ªÉm tra API endpoint
GET /api/v1/user-conference-assignments?userId=1

// 4. Ki·ªÉm tra console logs trong browser
// M·ªü DevTools > Console ƒë·ªÉ xem logs
            </div>
        </div>

        <div class="debug-section">
            <div class="debug-title">Test Results</div>
            <div id="test-results">
                <div class="debug-item">
                    <span>Authentication Status</span>
                    <span class="status pending">Not tested</span>
                </div>
                <div class="debug-item">
                    <span>API Response</span>
                    <span class="status pending">Not tested</span>
                </div>
                <div class="debug-item">
                    <span>Hook State</span>
                    <span class="status pending">Not tested</span>
                </div>
                <div class="debug-item">
                    <span>UI Rendering</span>
                    <span class="status pending">Not tested</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        function log(message) {
            const logContainer = document.getElementById('debug-logs');
            const timestamp = new Date().toLocaleTimeString();
            logContainer.innerHTML += `[${timestamp}] ${message}\n`;
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateTestResult(testName, status) {
            const results = document.getElementById('test-results');
            const items = results.querySelectorAll('.debug-item');
            items.forEach(item => {
                if (item.textContent.includes(testName)) {
                    const statusSpan = item.querySelector('.status');
                    statusSpan.textContent = status;
                    statusSpan.className = `status ${status === 'PASS' ? 'pass' : status === 'FAIL' ? 'fail' : 'pending'}`;
                }
            });
        }

        async function testAuth() {
            log('üîê Testing Authentication...');
            try {
                // Check if user is logged in
                const token = localStorage.getItem('accessToken');
                if (!token) {
                    log('‚ùå No access token found');
                    updateTestResult('Authentication Status', 'FAIL');
                    return;
                }
                
                log('‚úÖ Access token found');
                
                // Test token validity
                const response = await fetch('/api/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const user = await response.json();
                    log(`‚úÖ User authenticated: ${user.name} (${user.role})`);
                    updateTestResult('Authentication Status', 'PASS');
                } else {
                    log('‚ùå Token invalid or expired');
                    updateTestResult('Authentication Status', 'FAIL');
                }
            } catch (error) {
                log(`‚ùå Auth test failed: ${error.message}`);
                updateTestResult('Authentication Status', 'FAIL');
            }
        }

        async function testAPI() {
            log('üåê Testing API Call...');
            try {
                const token = localStorage.getItem('accessToken');
                if (!token) {
                    log('‚ùå No token for API test');
                    updateTestResult('API Response', 'FAIL');
                    return;
                }

                // Get user ID from token or localStorage
                const userId = localStorage.getItem('userId') || '1';
                
                const response = await fetch(`/api/v1/user-conference-assignments?userId=${userId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                log(`üì° API Response Status: ${response.status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log(`üìä API Response Data: ${JSON.stringify(data, null, 2)}`);
                    
                    if (data.data && data.data.length > 0) {
                        log(`‚úÖ Found ${data.data.length} conference assignments`);
                        updateTestResult('API Response', 'PASS');
                    } else {
                        log('‚ö†Ô∏è API returned empty data - user may not have conference assignments');
                        updateTestResult('API Response', 'FAIL');
                    }
                } else {
                    log(`‚ùå API Error: ${response.status} ${response.statusText}`);
                    const errorText = await response.text();
                    log(`‚ùå Error Details: ${errorText}`);
                    updateTestResult('API Response', 'FAIL');
                }
            } catch (error) {
                log(`‚ùå API test failed: ${error.message}`);
                updateTestResult('API Response', 'FAIL');
            }
        }

        async function testHook() {
            log('ü™ù Testing Hook...');
            try {
                // This would need to be tested in the actual React app
                log('‚ö†Ô∏è Hook testing requires React DevTools');
                log('üí° Check browser console for useConferencePermissions logs');
                log('üí° Look for: "useConferencePermissions - fetchConferencePermissions called"');
                log('üí° Look for: "useConferencePermissions - response.data:"');
                
                updateTestResult('Hook State', 'PENDING');
            } catch (error) {
                log(`‚ùå Hook test failed: ${error.message}`);
                updateTestResult('Hook State', 'FAIL');
            }
        }

        async function testUI() {
            log('üé® Testing UI Display...');
            try {
                // Check if conference selector is visible
                const conferenceSelector = document.querySelector('[data-testid="conference-selector"]') || 
                                        document.querySelector('.conference-selector') ||
                                        document.querySelector('[class*="conference"]');
                
                if (conferenceSelector) {
                    log('‚úÖ Conference selector element found');
                    log(`üì± Element content: ${conferenceSelector.textContent}`);
                    updateTestResult('UI Rendering', 'PASS');
                } else {
                    log('‚ùå Conference selector element not found');
                    log('üí° Check if component is properly imported and rendered');
                    updateTestResult('UI Rendering', 'FAIL');
                }
            } catch (error) {
                log(`‚ùå UI test failed: ${error.message}`);
                updateTestResult('UI Rendering', 'FAIL');
            }
        }

        // Auto-run basic checks
        window.onload = function() {
            log('üöÄ Starting automatic debug checks...');
            setTimeout(testAuth, 1000);
        };
    </script>
</body>
</html>
